<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Get started with {morphology} • morphology</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Get started with {morphology}">
<meta property="og:description" content="morphology">
<meta property="og:image" content="https://rogiersbart.github.io/morphology/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">morphology</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/morphology.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/background.html">Background</a>
    </li>
    <li>
      <a href="../articles/benchmarks.html">Benchmarks</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Get started with {morphology}</h1>
            
      
      
      <div class="hidden name"><code>morphology.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="we-need-some-example-image-first">We need some example image first<a class="anchor" aria-label="anchor" href="#we-need-some-example-image-first"></a>
</h2>
<p>The {morphology} package comes with the function
<code><a href="../reference/gen_fully_penetrable_spheres.html">gen_fully_penetrable_spheres()</a></code> to generate fully penetrable
spheres, where the matrix is labelled with 0, and the spheres with 1.
For demonstration purposes, however, an array with more than two
categories is more useful, and hence we combine two calls of this
function here:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">morphology</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #FF5555;">!</span> Package {<span style="color: #BBBB00;">morphology</span>} is still in its experimental lifecycle stage.</span></span>
<span><span class="co">#&gt; <span style="color: #FF5555;">!</span> Use at your own risk, and submit issues here:</span></span>
<span><span class="co">#&gt; <span style="color: #FF5555;">!</span> &lt;<span style="color: #00BBBB;">https://github.com/rogiersbart/morphology/issues</span>&gt;</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">spheres_large</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_fully_penetrable_spheres.html">gen_fully_penetrable_spheres</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fl">0.6</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">spheres_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_fully_penetrable_spheres.html">gen_fully_penetrable_spheres</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fl">0.2</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">spheres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">spheres_large</span>, <span class="va">spheres_small</span> <span class="op">*</span> <span class="fl">2L</span><span class="op">)</span></span></code></pre></div>
<p>Visually, the results look like this:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">spheres</span><span class="op">[</span>, , <span class="fl">1</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/as.raster.html" class="external-link">as.raster</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>interpolate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>Note that since we allow working with vectors, matrices as well as
arrays, we need a convention for the dimension names. For 3D arrays, we
consider the array indices to be the y (row index), x (column index),
and z (layer index) dimensions respectively. For 2D arrays or matrices,
we use y and x correspondingly. For 1D vectors or arrays, we use x. This
ensures we stick to the column-major order used everywhere in R, and at
the same time that, when working in 1D, we work in the x direction,
which should be more intuitive. Of course, for complete control, the
user can always put their 1D or 2D data in a 3D array in a different
way.</p>
<p>The following illustrates what happens internally in the {morphology}
workflow (through <code>morphology:::prep_array()</code>) with
vector/matrix/array inputs prior to any descriptor evaluation:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span><span class="op">[</span><span class="fl">1</span>, , <span class="fl">1</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  int [1:200] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="va">spheres</span><span class="op">[</span><span class="fl">1</span>, , <span class="fl">1</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu">morphology</span><span class="fu">:::</span><span class="fu">prep_array</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  int [1, 1:200, 1] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="va">spheres</span><span class="op">[</span> , , <span class="fl">1</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  int [1:200, 1:200] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="va">spheres</span><span class="op">[</span> , , <span class="fl">1</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu">morphology</span><span class="fu">:::</span><span class="fu">prep_array</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  int [1:200, 1:200, 1] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="va">spheres</span><span class="op">[</span> , ,  <span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  int [1:200, 1:200, 1:200] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="va">spheres</span><span class="op">[</span> , ,  <span class="op">]</span> <span class="op">|&gt;</span> <span class="fu">morphology</span><span class="fu">:::</span><span class="fu">prep_array</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  int [1:200, 1:200, 1:200] 1 1 1 1 1 1 1 1 1 1 ...</span></span></code></pre></div>
<p>This means that</p>
<ul>
<li>any vector or 1D array is transformed into a one row, one layer 3D
array, and</li>
<li>any matrix or 2D array is transformed into a one layer 3D
array.</li>
</ul>
<p>For the sake of example, we continue in the rest of this document
with the 3D <code>spheres</code> array, but the workflow is equally
applicable to 2D or 1D arrays.</p>
</div>
<div class="section level2">
<h2 id="we-use-a-simple-but-flexible-workflow">We use a simple but flexible workflow<a class="anchor" aria-label="anchor" href="#we-use-a-simple-but-flexible-workflow"></a>
</h2>
<p>The minimal {morphology} workflow consists of a pipe chain of 4
functions, which make up a mini domain-specific language (DSL) for
nearest neighbour-based morphological descriptors:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">description</span> <span class="op">&lt;-</span> <span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">41</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The different steps in the pipe chain serve the following
purposes:</p>
<ul>
<li><p><code><a href="../reference/look_at.html">look_at()</a></code> <strong>transforms the array into a data
frame (tibble)</strong>, and defines the target category, the neighbour
category, and what information to include (<code>"voxels"</code> is the
baseline for matching voxels, <code>"components"</code> adds
connectivity information, and <code>"paths"</code> adds pathlenghts on
top of connectivity),</p></li>
<li><p><code><a href="../reference/look_in.html">look_in()</a></code> <strong>modifies the obtained data
frame</strong>, to accommodate for the requested <code>direction</code>,
and subset of all voxels (through <code>every</code>),</p></li>
<li><p><code><a href="../reference/look_for.html">look_for()</a></code> then defines how many
<code>neighbours</code> to look for, <code>within</code> what distance,
and whether to include neighbours of the border voxels for edge
correction, and then <strong>performs the nearest neighbour
search</strong>, and finally</p></li>
<li><p><code><a href="../reference/describe.html">describe()</a></code> typically <strong>summarises the number
of neighbours obtained in function of distance</strong>.</p></li>
</ul>
<p>Splitting this up into different functions improves readability, but
also allows us to break up the pipe chain, to cache the intermediate
results, so multiple morphological descriptions can be made without
repeating the same tasks. For instance, if we want both the x and y
directional results, we can modify the above to:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">intermediate_result</span> <span class="op">&lt;-</span> <span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> </span>
<span><span class="va">description_x</span> <span class="op">&lt;-</span> <span class="va">intermediate_result</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">41</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"direction x"</span><span class="op">)</span></span>
<span><span class="va">description_y</span> <span class="op">&lt;-</span> <span class="va">intermediate_result</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">41</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"direction y"</span><span class="op">)</span></span></code></pre></div>
<p>The result is always a data frame (tibble) with <code>x</code> and
<code>y</code> columns (and optionally a <code>name</code> column, when
a name is provided in the <code><a href="../reference/describe.html">describe()</a></code> call), where
<code>x</code> normally is distance, and <code>y</code> the number of
neighbours (but that can change in function of the type of summaries
requested, and scaling (see further below)):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">description</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 × 2</span></span></span>
<span><span class="co">#&gt;        x     y</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>   0.5 1.90 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>   1.5 1.81 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>   2.5 1.73 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>   3.5 1.65 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>   4.5 1.57 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>   5.5 1.50 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>   6.5 1.43 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>   7.5 1.37 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>   8.5 1.31 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>   9.5 1.25 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>  10.5 1.20 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>  11.5 1.15 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>  12.5 1.11 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>  13.5 1.06 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>  14.5 1.02 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span>  15.5 0.987</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span>  16.5 0.954</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span>  17.5 0.924</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span>  18.5 0.896</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span>  19.5 0.871</span></span></code></pre></div>
<p>We can visualise things with a helper function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">description</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"distance"</span>, y <span class="op">=</span> <span class="st">"neighbours"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Or for the x and y directions, which behave similarly in this
isotropic image:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">description_x</span>, <span class="va">description_y</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"distance"</span>, y <span class="op">=</span> <span class="st">"neighbours"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>When we want to use multiple summary functions in the
<code><a href="../reference/describe.html">describe()</a></code> step, we do not have to split up the pipe chain,
but can just continue with more <code><a href="../reference/describe.html">describe()</a></code> calls, only
making sure we provide an adequate <code>name</code> each time:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">description</span> <span class="op">&lt;-</span> <span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">41</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">q25</span>, name <span class="op">=</span> <span class="st">"q25"</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">q50</span>, name <span class="op">=</span> <span class="st">"q50"</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">q75</span>, name <span class="op">=</span> <span class="st">"q75"</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">description</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"distance"</span>, y <span class="op">=</span> <span class="st">"neighbours"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>To enable this, we keep track of the nearest neighbour search results
by using object attributes. This does make the objects returned by
<code><a href="../reference/describe.html">describe()</a></code> quite a bit larger than just the neighbours
versus distance data frame. Hence, we included a function
<code><a href="../reference/finalise.html">finalise()</a></code> dedicated at dropping those attributes:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lobstr</span><span class="fu">::</span><span class="fu"><a href="https://lobstr.r-lib.org/reference/obj_size.html" class="external-link">obj_size</a></span><span class="op">(</span><span class="va">description</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1.14 GB</span></span>
<span><span class="va">description</span> <span class="op">&lt;-</span> <span class="va">description</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/finalise.html">finalise</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">lobstr</span><span class="fu">::</span><span class="fu"><a href="https://lobstr.r-lib.org/reference/obj_size.html" class="external-link">obj_size</a></span><span class="op">(</span><span class="va">description</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2.55 kB</span></span></code></pre></div>
<p>Finally, there is one more function to learn about:
<code><a href="../reference/scale_by.html">scale_by()</a></code>. It does not really bring new possibilities in
terms of morphological description, but it can normalise or scale the
obtained results in different ways, which allows us to reproduce certain
morphological quantities exactly in the way they are defined in
literature. If instead of a number of neighbours in function of
distance, we want for instance a probability of obtaining two points of
our target category, in function of their separation distance, we can
do:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">41</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/scale_by.html">scale_by</a></span><span class="op">(</span><span class="st">"inverse neighbourhood"</span>, <span class="st">"proportion"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"distance"</span>, y <span class="op">=</span> <span class="st">"probability"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>Here we first divide the number of neighbours found by the derivative
of the total number of neighbours within the given distance (scale by
inverse neighbourhood; the derivative is taken automatically if
<code>cumulative</code> is <code>FALSE</code> in the
<code><a href="../reference/describe.html">describe()</a></code> call). This gives us the probability of finding
a neighbour of our category of interest at a given distance from a voxel
of that category. Additionally, we scale by the proportion
(<em>i.e.</em> the probability for a single point to belong to our
category of interest), to turn this into the probability of any two
points separated by the given distance, to both belong to the category
of interest.</p>
<p>This brief overview of the different functions, and how to combine
them, should give you a pretty good idea on the {morphology} workflow. A
more detailed look into what you can do with it is provided in the next
section, and the function documentation provides more details on all the
different arguments and what they can be used for.</p>
</div>
<div class="section level2">
<h2 id="we-can-approximate-many-common-descriptors">We can approximate many common descriptors<a class="anchor" aria-label="anchor" href="#we-can-approximate-many-common-descriptors"></a>
</h2>
<p>In this section we go over several commonly used morphological
quantities/descriptors, and illustrate how to implement them with the
{morphology} workflow. For a series of benchmarks with analytical
expressions, and comparison against other packages available in the R
ecosystem, have a look at the “Benchmarks” article.</p>
<div class="section level3">
<h3 id="volume-fraction-proportion">Volume fraction / proportion<a class="anchor" aria-label="anchor" href="#volume-fraction-proportion"></a>
</h3>
<p>While not using the {morphology} workflow, we quickly illustrate here
how to obtain the volume fraction, or proportion, of a certain category,
just to be complete. We use it later below for normalization through
<code><a href="../reference/scale_by.html">scale_by()</a></code>, to approximate other commonly used descriptors,
but in itself, it also is a very important descriptor. With a given
array, we can just use the mean of the logical expression that searches
for equality with the index of our category of interest to get the
corresponding volume fraction:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">spheres</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.2059961</span></span></code></pre></div>
<p>To list the volume fractions of all categories, we can do:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">spheres</span><span class="op">)</span><span class="op">)</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">spheres</span> <span class="op">==</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">spheres</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;         1         0         2 </span></span>
<span><span class="co">#&gt; 0.4563375 0.3376664 0.2059961</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="two-point-correlation-function">Two-point correlation function<a class="anchor" aria-label="anchor" href="#two-point-correlation-function"></a>
</h3>
<p>The two-point correlation function provides the probability that two
points, separated by a distance r, both belong to the category of
interest. It corresponds to the most basic nearest neighbour search, but
we need to normalize this by the derivative of the total amount of
neighbours of any category, which can be approximated by the derivative
of the volume <span class="math inline">\(\frac{4}{3} \pi r^3\)</span>
(<em>i.e.</em> <span class="math inline">\(4 \pi r^2\)</span> for small
<span class="math inline">\(\Delta r\)</span>) and additionally the
proportion <span class="math inline">\(\lambda\)</span> of our
considered category, to obtain the two-point correlation function. The
<code><a href="../reference/scale_by.html">scale_by()</a></code> function can take care of this, as explained
above:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">41</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/scale_by.html">scale_by</a></span><span class="op">(</span><span class="st">"inverse neighbourhood"</span>, <span class="st">"proportion"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"distance"</span>, y <span class="op">=</span> <span class="st">"probability"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>Note that a bivariate version of this can be obtained by providing
another category to the <code>in_relation_to</code> argument in the
<code><a href="../reference/look_at.html">look_at()</a></code> call. Also note this is related to the covariance
function, variogram or correlogram in classic geostatistics, when
applied to an indicator field of the target category. Instead of looking
at the amount of voxel pairs both in the target category, there, the
variance of the difference between the voxel pairs (variogram), the
covariance of the voxel pairs (covariance function) or the correlation
between them is considered. These descriptors thus average over all
possible events (0, 0), (1, 0), (0, 1) and (1, 1), while here we only
provide the proportion of (1, 1) events. Hence, to approximate these
descriptors, we for instance additionally need to evaluate the
proportion of (0, 0) events, and then the remaining proportion can be
attributed to (0, 1) or (1, 0), which are equivalent in terms of
covariance, correlation and the variance of the difference. For
distances beyond the correlation length, the covariance and correlogram
become zero, while half of the variogram (semivariogram) goes to the
variance of the corresponding Bernoulli variable <span class="math inline">\(\lambda ( 1-\lambda)\)</span>, with <span class="math inline">\(\lambda\)</span> the proportion of the target
category.</p>
</div>
<div class="section level3">
<h3 id="spectral-density-function">Spectral density function<a class="anchor" aria-label="anchor" href="#spectral-density-function"></a>
</h3>
<p>The spectral density function can be obtained by taking the Fourier
transform of the two-point correlation function according to the
Wiener-Khinchin theorem (see <em>e.g.</em> <span class="citation">Bostanabad et al. (2018)</span>). Here we postprocess
the outputs of the two-point correlation function calculation, to obtain
the strengths of the different harmonics:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">41</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/scale_by.html">scale_by</a></span><span class="op">(</span><span class="st">"inverse neighbourhood"</span>, <span class="st">"proportion"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fft.html" class="external-link">fft</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/complex.html" class="external-link">Mod</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">2</span> <span class="op">*</span> <span class="va">y</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"frequency"</span>, y <span class="op">=</span> <span class="st">"strength"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<p>Note that the frequency here is relative to the maximum search
distance <code>within</code>.</p>
</div>
<div class="section level3">
<h3 id="reduced-second-moment-k-function">Reduced second moment / K function<a class="anchor" aria-label="anchor" href="#reduced-second-moment-k-function"></a>
</h3>
<p>The reduced second moment, or K function, is the expectation of the
number of neighbours within a distance <span class="math inline">\(r\)</span>, normalized by the proportion of our
considered category. Hence, it is the cumulative version of our nearest
neighbour search, normalized in a different way:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">41</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/scale_by.html">scale_by</a></span><span class="op">(</span><span class="st">"inverse proportion"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"distance"</span>, y <span class="op">=</span> <span class="st">"reduced second moment"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<p>Note that a bivariate version of this can be obtained by providing
another category to the <code>in_relation_to</code> argument in the
<code><a href="../reference/look_at.html">look_at()</a></code> call.</p>
</div>
<div class="section level3">
<h3 id="pair-correlation-function">Pair correlation function<a class="anchor" aria-label="anchor" href="#pair-correlation-function"></a>
</h3>
<p>The pair correlation function is again related to the above two, with
the main difference that it goes to one at large distance, for which any
spatial correlation disappears. This is achieved by dividing the
two-point correlation function by the probability to have both voxels
within the target phase at arbitrary large distance, which is given by
the square of the proportion <span class="math inline">\(\lambda^2\)</span> (for the two-point correlation
function, we multiply with the proportion, so dividing again by the
square proportion results in a division by the proportion, or scaling by
the <code>"inverse proportion"</code>):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">41</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/scale_by.html">scale_by</a></span><span class="op">(</span><span class="st">"inverse neighbourhood"</span>, <span class="st">"inverse proportion"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"distance"</span>, y <span class="op">=</span> <span class="st">"pair correlation function"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>Alternatively, it can be obtained by using the non-cumulative (or
derivative) version of the reduced second moment, scaled by the total
amount of neighbours (derivative of the volume <span class="math inline">\(\frac{4}{3} \pi r^3\)</span>, or <span class="math inline">\(4 \pi r^2\)</span> for small <span class="math inline">\(\Delta r\)</span>). Note that a bivariate version
of this can be obtained by providing another category to the
<code>in_relation_to</code> argument in the <code><a href="../reference/look_at.html">look_at()</a></code>
call.</p>
</div>
<div class="section level3">
<h3 id="cluster-function">Cluster function<a class="anchor" aria-label="anchor" href="#cluster-function"></a>
</h3>
<p>The cluster function provides the probability that two points
separated by a certain distance belong to the category of interest and
that they are connected through voxels of the same category. To enable
this, we need to identify the connected components within a given
category. Given our workflow, we can only differentiate between
connected and disconnected neighbours at the <code><a href="../reference/describe.html">describe()</a></code>
step:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"components"</span>, of_category <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">41</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, name <span class="op">=</span> <span class="st">"total"</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, connected <span class="op">=</span> <span class="cn">TRUE</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span>, name <span class="op">=</span> <span class="st">"connected"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, connected <span class="op">=</span> <span class="cn">FALSE</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span>, name <span class="op">=</span> <span class="st">"disconnected"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"distance"</span>, y <span class="op">=</span> <span class="st">"neighbours"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>The ratio of the connected neighbours versus the total neighbours
gives us the probability of being connected, given the fact that we
already have two voxels belonging to the category of interest. If, on
the other hand, we scale the connected neighbours curve by the total
number of neighbours of any category which can be approximated by <span class="math inline">\(\frac{4}{3} \pi r^3\)</span>, and additionally the
proportion of our considered category, we obtain a cumulative version of
the classic cluster function:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"components"</span>, of_category <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">41</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, connected <span class="op">=</span> <span class="cn">TRUE</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/scale_by.html">scale_by</a></span><span class="op">(</span><span class="st">"inverse neighbourhood"</span>, <span class="st">"proportion"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"max distance"</span>, y <span class="op">=</span> <span class="st">"probability"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>Or by using the incremental volume change, we can get the
non-cumulative version, or the classic cluster function:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"components"</span>, of_category <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">41</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, connected <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/scale_by.html">scale_by</a></span><span class="op">(</span><span class="st">"inverse neighbourhood"</span>, <span class="st">"proportion"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"distance"</span>, y <span class="op">=</span> <span class="st">"probability"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="connected-component-size-distribution">Connected component size distribution<a class="anchor" aria-label="anchor" href="#connected-component-size-distribution"></a>
</h3>
<p>If we now go back to the cumulative version of the amount of
connected neighbours, and we could go to infinite numbers of neighbours
and distances, we would obtain the size distribution of the connected
components of our category of interest at the far right side of
something like this:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"components"</span>, of_category <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"xyz"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">500</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">q25</span>, connected <span class="op">=</span> <span class="cn">TRUE</span>, name <span class="op">=</span> <span class="st">"q25"</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">q50</span>, connected <span class="op">=</span> <span class="cn">TRUE</span>, name <span class="op">=</span> <span class="st">"q50"</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">q75</span>, connected <span class="op">=</span> <span class="cn">TRUE</span>, name <span class="op">=</span> <span class="st">"q75"</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<p>However, as the nearest neighbour search becomes computationally
intractable at some point, it can be hard to calculate the actual size
distribution through the {morphology} workflow, and it can better be
done by just counting component ids in the output from
<code><a href="../reference/look_at.html">look_at()</a></code>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"components"</span>, of_category <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="va">_</span><span class="op">[[</span><span class="st">"component"</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span>cut <span class="op">=</span> <span class="fl">0</span>, n <span class="op">=</span> <span class="fl">50</span>, bw <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="va">_</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"connected component size"</span>, y <span class="op">=</span> <span class="st">"probability"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<p>With the full workflow, we hit the upper limit of neighbours with the
upper tail of the distribution around a distance of 10, and distances
beyond 20 are not investigated. The cumulative connected neighbours
however do provide a local approximation, and illustrates what happens
when we increase the local window (increasing distance), which is very
valuable as well. A more robust measure than the connected component
size distribution, is the distribution of shortest distances of the
category of interest, to any other category, which is also called the
radial density distribution. This is typically what is used for
<em>e.g.</em> the pore size distribution in porous media. The evaluation
of this is illustrated further below.</p>
</div>
<div class="section level3">
<h3 id="lineal-path-function">Lineal path function<a class="anchor" aria-label="anchor" href="#lineal-path-function"></a>
</h3>
<p>By default, the identification of connected components uses a 3D disk
kernel, 3 voxels wide in every dimension. The kernel can be modified,
however, and for the lineal path function, we look at connectivity in
1D, in our case along x, y, or z, as follows:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"components"</span>, of_category <span class="op">=</span> <span class="fl">2</span>, kernel_width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">41</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, name <span class="op">=</span> <span class="st">"total"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, connected <span class="op">=</span> <span class="cn">TRUE</span>, name <span class="op">=</span> <span class="st">"connected"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, connected <span class="op">=</span> <span class="cn">FALSE</span>, name <span class="op">=</span> <span class="st">"disconnected"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"distance"</span>, y <span class="op">=</span> <span class="st">"neighbours"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
<p>Similar to the cluster function, the ratio of the connected
neighbours versus the total neighbours gives us the probability of being
connected, given the fact that we already have two voxels belonging to
the category of interest. If, on the other hand, we scale the connected
neighbours curve by the total number of neighbours of any category,
which can be approximated in 1D by <span class="math inline">\(2r\)</span> (its derivative is used here in fact,
as <code>cumulative = FALSE</code>), and additionally the proportion of
our considered category, we obtain the lineal path function:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"components"</span>, of_category <span class="op">=</span> <span class="fl">2</span>, kernel_width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">41</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, connected <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/scale_by.html">scale_by</a></span><span class="op">(</span><span class="st">"inverse neighbourhood"</span>, <span class="st">"proportion"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"distance"</span>, y <span class="op">=</span> <span class="st">"probability"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
<p>Note that it is also possible to use a 2D kernel, which allows
checking 2D connectivity in 3D arrays for instance, which can be
compared to 2D connectivity of 2D arrays.</p>
</div>
<div class="section level3">
<h3 id="chord-length-distribution">Chord length distribution<a class="anchor" aria-label="anchor" href="#chord-length-distribution"></a>
</h3>
<p>The chord length distribution function is basically a size
distribution for 1D connected components, and hence it is related to the
lineal path function in the same way as the size distribution is related
to the isotropic cluster function:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"components"</span>, of_category <span class="op">=</span> <span class="fl">2</span>, kernel_width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">41</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">q25</span>, connected <span class="op">=</span> <span class="cn">TRUE</span>, name <span class="op">=</span> <span class="st">"q25"</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">q50</span>, connected <span class="op">=</span> <span class="cn">TRUE</span>, name <span class="op">=</span> <span class="st">"q50"</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">q75</span>, connected <span class="op">=</span> <span class="cn">TRUE</span>, name <span class="op">=</span> <span class="st">"q75"</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"distance"</span>, y <span class="op">=</span> <span class="st">"neighbours"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
<p>Only at infinite numbers of neighbours and infinite distance, our
approximation would always be exact, but for practical purposes, and
small connected component sizes, the local approximation may be
sufficient. When the actual distribution is really required, it is hence
better to count component ids in the output from
<code><a href="../reference/look_at.html">look_at()</a></code>:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"components"</span>, of_category <span class="op">=</span> <span class="fl">2</span>, kernel_width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="va">_</span><span class="op">[[</span><span class="st">"component"</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span>cut <span class="op">=</span> <span class="fl">0</span>, n <span class="op">=</span> <span class="fl">50</span>, bw <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="va">_</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"chord length"</span>, y <span class="op">=</span> <span class="st">"probability"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="nearest-neighbour-distance-distribution-function">Nearest neighbour distance distribution function<a class="anchor" aria-label="anchor" href="#nearest-neighbour-distance-distribution-function"></a>
</h3>
<p>The nearest neighbour distance distribution function provides the
cumulative distribution of distances between any point of a certain
category, to its nearest neighbour of the same category. It is typically
used in the description of spatial point patterns (<em>e.g.</em>
<code><a href="https://rdrr.io/pkg/spatstat.explore/man/G3est.html" class="external-link">spatstat.explore::G3est()</a></code>), and can be obtained with:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"xyz"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">1</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"distance"</span>, y <span class="op">=</span> <span class="st">"neighbours"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
<p>While not so useful for smooth categorical arrays, as the nearest
neighbour then typically is only a single voxel away, it can easily be
generalized to a summary of the number of neighbours within a certain
distance, which corresponds to the two-point correlation function and
the other related quantities described above (with the proper scaling),
or alternatively the distribution of the distance to the nth nearest
neighbour, which we can obtain by describing a summary function
<code>of = "distance"</code> instead of
<code>of = "neighbours"</code>:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"xyz"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">50</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">min</span>, of <span class="op">=</span> <span class="st">"distance"</span>, name <span class="op">=</span> <span class="st">"min"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, of <span class="op">=</span> <span class="st">"distance"</span>, name <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">max</span>, of <span class="op">=</span> <span class="st">"distance"</span>, name <span class="op">=</span> <span class="st">"max"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"neighbour"</span>, y <span class="op">=</span> <span class="st">"distance"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-29-1.png" width="700"></p>
<p>where summaries of the classic distribution are included at
<code>x == 1</code>.</p>
</div>
<div class="section level3">
<h3 id="empty-space-function">Empty space function<a class="anchor" aria-label="anchor" href="#empty-space-function"></a>
</h3>
<p>The idea of the empty space function is similar. The only difference
is that we are not performing a self-query (<em>i.e.</em> we look for
neighbours of the same category), but a query for all voxels, matching
them with neighbours of the category of interest:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, in_relation_to <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"xyz"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">1</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"distance"</span>, y <span class="op">=</span> <span class="st">"cumulative probability"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-30-1.png" width="700"></p>
<p>When not looking at all categories, but performing a query for a
single specific category versus another one, we generalize this to an
inter-category distance function:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">1</span>, in_relation_to <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"xyz"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">1</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"distance"</span>, y <span class="op">=</span> <span class="st">"cumulative probability"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-31-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="radial-density-distribution-pore-size-distribution">Radial density distribution / Pore size distribution<a class="anchor" aria-label="anchor" href="#radial-density-distribution-pore-size-distribution"></a>
</h3>
<p>When we use this inter-category distance function to look at the
shortest distances from our category of interest, to any other category,
we obtain the size distribution of our category. This is typically used
for <em>e.g.</em> the pore size distribution in porous media, where it
is commonly described as the statistical distribution of the radius of
the biggest sphere that can be fitted into a pore at a given location.
We can implement it as follows:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">2</span>, in_relation_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"xyz"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">1</span>, within <span class="op">=</span> <span class="fl">40</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"sphere radius"</span>, y <span class="op">=</span> <span class="st">"probability"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
<p>Whereas the cumulative distribution can be obtained with:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">2</span>, in_relation_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"xyz"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">1</span>, within <span class="op">=</span> <span class="fl">40</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"sphere radius"</span>, y <span class="op">=</span> <span class="st">"cumulative probability"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-33-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="specific-surface-area">Specific surface area<a class="anchor" aria-label="anchor" href="#specific-surface-area"></a>
</h3>
<p>The surface area of a certain category can also be obtained by using
the inter-category distance function, but extending the query now to six
neighbours, while limiting the maximum distance to one, and summing up
the results:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">1</span>, in_relation_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"xyz"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">6</span>, within <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">sum</span>, at <span class="op">=</span> <span class="fl">1</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;       x      y</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 <span style="text-decoration: underline;">855</span>461</span></span></code></pre></div>
<p>Where we can get the specific surface area by dividing the result by
the volume of category 0 (divide by the product of the proportion times
the dimensions of the array):</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">1</span>, in_relation_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"xyz"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">6</span>, within <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">sum</span>, at <span class="op">=</span> <span class="fl">1</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/scale_by.html">scale_by</a></span><span class="op">(</span><span class="st">"inverse proportion"</span>, <span class="st">"inverse dimensions"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;       x     y</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 0.234</span></span></code></pre></div>
<p>Note by modifying the direction to look in to one that is 2D or 1D,
we can extend this respectively to perimeter length and transition
probabilities (for the latter, see further below).</p>
</div>
<div class="section level3">
<h3 id="interface-area">Interface area<a class="anchor" aria-label="anchor" href="#interface-area"></a>
</h3>
<p>The interface area can be obtained in a similar way, by using two
specific categories:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">1</span>, in_relation_to <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"xyz"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">6</span>, within <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">sum</span>, at <span class="op">=</span> <span class="fl">1</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;       x      y</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 <span style="text-decoration: underline;">365</span>520</span></span></code></pre></div>
<p>Note also here by modifying the direction, we can extend this to
inter-category perimeter and inter-category transition
probabilities.</p>
</div>
<div class="section level3">
<h3 id="transition-probabilities">Transition probabilities<a class="anchor" aria-label="anchor" href="#transition-probabilities"></a>
</h3>
<p>We can quantify transition probabilities as well, from one voxel to
the next, by looking at the close neighbours as for the interface area,
but normalising by the total area around all individual voxels of the
target phase (obtained by proportion times overall dimensions times the
number of faces per voxel (3)). Hence, the probability of going from a
voxel of category 1 to one of category 2 is:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">1</span>, in_relation_to <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"xyz"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">6</span>, within <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">sum</span>, at <span class="op">=</span> <span class="fl">1</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/scale_by.html">scale_by</a></span><span class="op">(</span><span class="st">"inverse proportion"</span>, <span class="st">"inverse dimensions"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span> <span class="op">/</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;   x          y</span></span>
<span><span class="co">#&gt; 1 1 0.03337442</span></span></code></pre></div>
<p>All transition probabilities for a given starting category sum up to
one, which we can see if we evaluate the one for category 0:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">1</span>, in_relation_to <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"xyz"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">6</span>, within <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">sum</span>, at <span class="op">=</span> <span class="fl">1</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/scale_by.html">scale_by</a></span><span class="op">(</span><span class="st">"inverse proportion"</span>, <span class="st">"inverse dimensions"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span> <span class="op">/</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;   x          y</span></span>
<span><span class="co">#&gt; 1 1 0.04473489</span></span></code></pre></div>
<p>And finally the self-query one, where we additionally have to divide
by 2, as every face is counted twice here:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">1</span>, in_relation_to <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"xyz"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">6</span>, within <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">sum</span>, at <span class="op">=</span> <span class="fl">1</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/scale_by.html">scale_by</a></span><span class="op">(</span><span class="st">"inverse proportion"</span>, <span class="st">"inverse dimensions"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span> <span class="op">/</span> <span class="fl">3</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;   x         y</span></span>
<span><span class="co">#&gt; 1 1 0.9307166</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="coarseness">Coarseness<a class="anchor" aria-label="anchor" href="#coarseness"></a>
</h3>
<p>The coarseness (<span class="citation">Coker and Torquato
(1995)</span>) is defined as the standard deviation of the local volume
fraction of our target phase, divided by the volume fraction, and
depends on the used window size. Estimating it with {morphology} is
rather straightforward (here in 1D) as</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">41</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">sd</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/scale_by.html">scale_by</a></span><span class="op">(</span><span class="st">"inverse neighbourhood"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"window radius"</span>, y <span class="op">=</span> <span class="st">"coarseness"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-40-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="tortuosity">Tortuosity<a class="anchor" aria-label="anchor" href="#tortuosity"></a>
</h3>
<p>Tortuosity is the average ratio of shortest paths connecting two
voxels through voxels of their own category, to the euclidean distance
between them. We can obtain this with {morphology} by calculating the
shortest paths, and scaling them by the inverse distance:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"paths"</span>, of_category <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span><span class="st">"x"</span>, every <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">1</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">50</span>, within <span class="op">=</span> <span class="fl">100</span>, from_border <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, of <span class="op">=</span> <span class="st">"pathlength"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/scale_by.html">scale_by</a></span><span class="op">(</span><span class="st">"inverse distance"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"distance"</span>, y <span class="op">=</span> <span class="st">"tortuosity"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-41-1.png" width="700"></p>
<p>Because of the default values for <code>at</code> in the
non-cumulative case, however, there is a mismatch here between the
pathlengths and distances, at small distances. We can fix this by
specifying <code>at</code> in such a way that the bin centers align with
the pathlengths as follows:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"paths"</span>, of_category <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span><span class="st">"x"</span>, every <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">1</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">50</span>, within <span class="op">=</span> <span class="fl">100</span>, from_border <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, of <span class="op">=</span> <span class="st">"pathlength"</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">99.5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/scale_by.html">scale_by</a></span><span class="op">(</span><span class="st">"inverse distance"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"distance"</span>, y <span class="op">=</span> <span class="st">"tortuosity"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-42-1.png" width="700"></p>
<p>Note that, depending on the dimensions of the connectivity kernel
specified, it is also possible to evaluate shortest paths in 2D, within
a 3D array, to compare results with those of a 2D array. This is similar
to the evaluation of 3D (cluster function), 2D, or 1D (lineal path)
connectivity, except that evaluating shortest paths in 1D does not make
sense, as this would reduce to the lineal path function.</p>
</div>
<div class="section level3">
<h3 id="quality-of-connections-function">Quality of connections function<a class="anchor" aria-label="anchor" href="#quality-of-connections-function"></a>
</h3>
<p>This descriptor, introduced by <span class="citation">Bagherian et
al. (2021)</span>, corresponds basically to inverse tortuosity in
function of distance.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spheres</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"paths"</span>, of_category <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span><span class="st">"x"</span>, every <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">1</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">50</span>, within <span class="op">=</span> <span class="fl">100</span>, from_border <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span></span>
<span>    <span class="va">mean</span>,</span>
<span>    of <span class="op">=</span> <span class="st">"pathlength"</span>,</span>
<span>    at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">99.5</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/scale_by.html">scale_by</a></span><span class="op">(</span><span class="st">"inverse distance"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">y</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"distance"</span>, y <span class="op">=</span> <span class="st">"quality of connections"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-43-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="we-do-have-some-drawbacks">We do have some drawbacks<a class="anchor" aria-label="anchor" href="#we-do-have-some-drawbacks"></a>
</h2>
<div class="section level3">
<h3 id="large-numbers-of-neighbours-becomes-problematic">Large numbers of neighbours becomes problematic<a class="anchor" aria-label="anchor" href="#large-numbers-of-neighbours-becomes-problematic"></a>
</h3>
<p>Nearest neighbour search becomes intractable very quickly, especially
in 2D or 3D, where it scales quadratically or cubically with distance.
Hence we limit the amount of neighbours and/or the maximum search
distance, which causes the morphological quantities to level off (when
cumulative), or drop to zero (otherwise) when we reach those limits.
There are some approaches to counter this, however:</p>
<ul>
<li>Make use of <code>every</code> within <code><a href="../reference/look_in.html">look_in()</a></code> for
longer-range investigations. This should give similar results, if scaled
properly (with <code>"inverse every"</code>), but reduces the amount of
neighbours linearly, quadratically, or cubically, when working in 1D, 2D
or 3D.</li>
<li>Instead of isotropic 3D search, make use of isotropic 2D search,
which makes that things scale quadratically instead of cubically.</li>
<li>Instead of isotropic 2D search, make use of directional 1D search,
which makes that things scale linearly instead of quadratically.</li>
<li>Make use of approximate nearest neighbour search, which may improve
computing time, but memory limitations are still the same.</li>
<li>Combine any of the above.</li>
</ul>
<p>Here we illustrate the effect of <code>every</code>:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">41</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, name <span class="op">=</span> <span class="st">"every = 1/1"</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   14.36    4.15   19.97</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="va">b</span> <span class="op">&lt;-</span> <span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"x"</span>, every <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">41</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, name <span class="op">=</span> <span class="st">"every = 1/2"</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">2</span><span class="op">)</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/scale_by.html">scale_by</a></span><span class="op">(</span><span class="st">"inverse every"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;    1.81    0.66    2.49</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"distance"</span>, y <span class="op">=</span> <span class="st">"neighbours"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-44-1.png" width="700"></p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lobstr</span><span class="fu">::</span><span class="fu"><a href="https://lobstr.r-lib.org/reference/obj_size.html" class="external-link">obj_sizes</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span></span>
<span><span class="co">#&gt; * 705.50 MB</span></span>
<span><span class="co">#&gt; *  88.21 MB</span></span></code></pre></div>
<p>Note that by providing a list of two elements to <code>every</code>,
the target category and the neighbour category datasets can be reduced
in different ways.</p>
<p>Here we illustrate the effect of dimensionality:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"xyz"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">524</span>, within <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, name <span class="op">=</span> <span class="st">"3D"</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/scale_by.html">scale_by</a></span><span class="op">(</span><span class="st">"inverse neighbourhood"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;  176.85  154.81  509.91</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="va">b</span> <span class="op">&lt;-</span> <span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"xy"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">79</span>, within <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, name <span class="op">=</span> <span class="st">"2D"</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/scale_by.html">scale_by</a></span><span class="op">(</span><span class="st">"inverse neighbourhood"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   21.93    6.90   30.00</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="va">c</span> <span class="op">&lt;-</span> <span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">11</span>, within <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, name <span class="op">=</span> <span class="st">"1D"</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/scale_by.html">scale_by</a></span><span class="op">(</span><span class="st">"inverse neighbourhood"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;    4.17    1.08    5.31</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">c</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"distance"</span>, y <span class="op">=</span> <span class="st">"probability"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 3 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 3 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-45-1.png" width="700"></p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lobstr</span><span class="fu">::</span><span class="fu"><a href="https://lobstr.r-lib.org/reference/obj_size.html" class="external-link">obj_sizes</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">c</span><span class="op">)</span></span>
<span><span class="co">#&gt; *   9.02 GB</span></span>
<span><span class="co">#&gt; *   1.49 GB</span></span>
<span><span class="co">#&gt; * 258.88 MB</span></span></code></pre></div>
<p>And finally of approximate nearest neighbour search:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">41</span>, within <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, name <span class="op">=</span> <span class="st">"error = 0"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   13.71    4.69   19.28</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="va">b</span> <span class="op">&lt;-</span> <span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">41</span>, within <span class="op">=</span> <span class="fl">20</span>, error <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, name <span class="op">=</span> <span class="st">"error = 5"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/scale_by.html">scale_by</a></span><span class="op">(</span><span class="st">"inverse every"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   13.00    4.41   17.68</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"distance"</span>, y <span class="op">=</span> <span class="st">"neighbours"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-46-1.png" width="700"></p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lobstr</span><span class="fu">::</span><span class="fu"><a href="https://lobstr.r-lib.org/reference/obj_size.html" class="external-link">obj_sizes</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span></span>
<span><span class="co">#&gt; * 705.50 MB</span></span>
<span><span class="co">#&gt; * 705.49 MB</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="only-one-kind-of-edge-correction-available">Only one kind of edge correction available<a class="anchor" aria-label="anchor" href="#only-one-kind-of-edge-correction-available"></a>
</h3>
<p>Only minus sampling is currently implemented. This means the maximum
possible neighbour distance to look for is half the size of the array,
although it is better to use shorter distances than that. The effect of
the correction is illustrated here:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">81</span>, within <span class="op">=</span> <span class="fl">40</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, name <span class="op">=</span> <span class="st">"from_border = FALSE"</span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">81</span>, within <span class="op">=</span> <span class="fl">40</span>, from_border <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, name <span class="op">=</span> <span class="st">"from_border = TRUE"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"distance"</span>, y <span class="op">=</span> <span class="st">"neighbours"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-47-1.png" width="700"></p>
<p>The wrap-around correction, used <em>e.g.</em> by <span class="citation">Pant (2016)</span> and <span class="citation">Lemmens
et al. (2019)</span>, is not that hard to implement for directional
search (using <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code> possibly in combination with
<code><a href="https://rdrr.io/r/base/aperm.html" class="external-link">aperm()</a></code>), but does introduce discontinuities and
corresponding biases as well. The main problem with it is however the
extension towards 2D and 3D isotropic search, where it requires more
memory.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">spheres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">81</span>, within <span class="op">=</span> <span class="fl">40</span>, from_border <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, name <span class="op">=</span> <span class="st">"minus sampling"</span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">spheres</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_at.html">look_at</a></span><span class="op">(</span><span class="st">"voxels"</span>, of_category <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_in.html">look_in</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/look_for.html">look_for</a></span><span class="op">(</span>neighbours <span class="op">=</span> <span class="fl">81</span>, within <span class="op">=</span> <span class="fl">40</span>, from_border <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/describe.html">describe</a></span><span class="op">(</span><span class="va">mean</span>, name <span class="op">=</span> <span class="st">"wrap around"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/visualise.html">visualise</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"distance"</span>, y <span class="op">=</span> <span class="st">"neighbours"</span><span class="op">)</span></span></code></pre></div>
<p><img src="morphology_files/figure-html/unnamed-chunk-48-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="point-pairs-occur-twice-in-any-self-query">Point pairs occur twice in any self-query<a class="anchor" aria-label="anchor" href="#point-pairs-occur-twice-in-any-self-query"></a>
</h3>
<p>While this is not a problem in itself, it is useful to be aware of
this. It does reduce the efficiency of self-queries systematically, and
it does affect scaling by the number of voxel faces for instance (see
the self-transition probability above).</p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-bagherian2021" class="csl-entry">
Bagherian, Amirhossein, Seyedfarzad Famouri, Mostafa Baghani, Daniel
George, Azadeh Sheidaei, and Majid Baniassadi. 2021. <span>“A New
Statistical Descriptor for the Physical Characterization and 3D
Reconstruction of Heterogeneous Materials.”</span> <em>Transport in
Porous Media</em>, August. <a href="https://doi.org/10.1007/s11242-021-01660-9" class="external-link">https://doi.org/10.1007/s11242-021-01660-9</a>.
</div>
<div id="ref-bostanabad2018" class="csl-entry">
Bostanabad, Ramin, Yichi Zhang, Xiaolin Li, Tucker Kearney, L. Catherine
Brinson, Daniel W. Apley, Wing Kam Liu, and Wei Chen. 2018.
<span>“Computational Microstructure Characterization and Reconstruction:
Review of the State-of-the-Art Techniques.”</span> <em>Progress in
Materials Science</em> 95 (June): 1–41. <a href="https://doi.org/10.1016/j.pmatsci.2018.01.005" class="external-link">https://doi.org/10.1016/j.pmatsci.2018.01.005</a>.
</div>
<div id="ref-coker1995" class="csl-entry">
Coker, David A., and Salvatore Torquato. 1995. <span>“Extraction of
Morphological Quantities from a Digitized Medium.”</span> <em>Journal of
Applied Physics</em> 77 (12): 6087–99. <a href="https://doi.org/10.1063/1.359134" class="external-link">https://doi.org/10.1063/1.359134</a>.
</div>
<div id="ref-lemmens2019a" class="csl-entry">
Lemmens, Laurent, Bart Rogiers, Diederik Jacques, Marijke Huysmans, Rudy
Swennen, Janos L. Urai, Guillaume Desbois, and Eric Laloy. 2019.
<span>“Nested Multiresolution Hierarchical Simulated Annealing Algorithm
for Porous Media Reconstruction.”</span> <em>Physical Review E</em> 100
(5): 053316. <a href="https://doi.org/10.1103/PhysRevE.100.053316" class="external-link">https://doi.org/10.1103/PhysRevE.100.053316</a>.
</div>
<div id="ref-pant2016" class="csl-entry">
Pant, Lalit Mohan. 2016. <span>“Stochastic Characterization and
Reconstruction of Porous Media.”</span> PhD thesis.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://rogiersbart.github.io" class="external-link">Bart Rogiers</a>, <a href="https://www.sckcen.be" class="external-link">SCK CEN</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
